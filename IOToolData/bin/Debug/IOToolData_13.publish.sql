/*
Deployment script for IOToolData

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "IOToolData"
:setvar DefaultFilePrefix "IOToolData"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'The following operation was generated from a refactoring log file 64a4be62-a222-434e-99db-6123c11dd4e1';

PRINT N'Rename [dbo].[Requests].[Materials] to Id_Material';


GO
EXECUTE sp_rename @objname = N'[dbo].[Requests].[Materials]', @newname = N'Id_Material', @objtype = N'COLUMN';


GO
PRINT N'The following operation was generated from a refactoring log file 0ac9bea0-0ed0-4dae-a244-9e4ad7bc9310';

PRINT N'Rename [dbo].[Requests].[CostCenter] to Id_CostCenter';


GO
EXECUTE sp_rename @objname = N'[dbo].[Requests].[CostCenter]', @newname = N'Id_CostCenter', @objtype = N'COLUMN';


GO
PRINT N'Creating Procedure [dbo].[spRequestInfo_Insert]...';


GO
CREATE PROCEDURE [dbo].[spRequestInfo_Insert]
	@Id_Request int,
	@Id_Requester int,
	@Id_Processor int,
	@IntervalHoursToPickUp nvarchar(50),
	@CommentRequester nvarchar(200),
	@CommentProcessor nvarchar(200),
	@CommentRequesterForClose nvarchar(200),
	@CommentProcessorForClose nvarchar(200),
	@Status nvarchar(50),
	@PremiumFreight int,
	@Id int output
AS
begin

	set nocount on;

	insert into dbo.[RequestInfo](Id_Request, Id_Requester, Id_Processor, IntervalHoursToPickUp, CommentRequester, CommentProcessor,
								  CommentRequesterForClose, CommentProcessorForClose, Status, PremiumFreight)
	values(@Id_Request, @Id_Requester, @Id_Processor, @IntervalHoursToPickUp, @CommentRequester, @CommentProcessor,
		   @CommentRequesterForClose, @CommentProcessorForClose, @Status, @PremiumFreight)
	
	set @Id = SCOPE_IDENTITY();
end
GO
PRINT N'Creating Procedure [dbo].[spRequests_Insert]...';


GO
CREATE PROCEDURE [dbo].[spRequests_Insert]
	@Month nvarchar(50),
	@Id_RequestType int,
	@Id_TransportType int,
	@Week int,
	@ETD datetime2(7),
	@ETA datetime2(7),
	@Id_SupplierFrom int,
	@Id_SupplierTo int,
	@Id_Material int,
	@Id_Transporter int,
	@AWB nvarchar(50),
	@Price money,
	@Id_CostCenter int,
	@BillNr nvarchar(50),
	@PalletNr int,
	@PricePallet money,
	@Id int output
AS
begin

	set nocount on;

	insert into dbo.[Requests](Month, Id_RequestType, Id_TransportType, Week, ETD, ETA, Id_SupplierFrom, Id_SupplierTo, Id_Material,
							   Id_Transporter, AWB, Price, Id_CostCenter, BillNr, PalletNr, PricePallet)
	values(@Month, @Id_RequestType, @Id_TransportType, @Week, @ETD, @ETA, @Id_SupplierFrom, @Id_SupplierTo, @Id_Material,
		   @Id_Transporter, @AWB, @Price, @Id_CostCenter, @BillNr, @PalletNr, @PricePallet);
	
	set @Id = SCOPE_IDENTITY();
end
GO
-- Refactoring step to update target server with deployed transaction logs
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '64a4be62-a222-434e-99db-6123c11dd4e1')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('64a4be62-a222-434e-99db-6123c11dd4e1')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0ac9bea0-0ed0-4dae-a244-9e4ad7bc9310')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0ac9bea0-0ed0-4dae-a244-9e4ad7bc9310')

GO

GO
PRINT N'Update complete.';


GO
